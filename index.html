<!DOCTYPE html>
<html lang="pt-br">

<head>
<meta charset="utf-8">
<META name="Author" lang="pt-br" content="Augusto Damasceno">
<meta name="copyright" content="Augusto Damasceno">
<title>App Compartilhemos</title>
</head>

<body>

<!--  Facebook Code -->
<script>
    // Init
    window.fbAsyncInit = function() {
        FB.init({
            appId      : '815858315213908',
            xfbml      : true,
            version    : 'v2.6'
        });

        // ADD ADDITIONAL FACEBOOK CODE HERE

        // Function test to post the time
        function postTime()
        {
            var text = "Time: "
                + new Date().getHours()
                + ':' 
                + new Date().getMinutes();
            
            // Post
            postThis(text);
        };

        // User to follow
        var following = '/SintonizeMCTI/feed?limit=3'; 
        var lastPost = '0'; 

        // Function to verify and post update of follow profile
        function postUpdate()
        {
            /// Test if there is a new post and post
            
            FB.login(function() {
                FB.api( '/me/feed',
                        'post', 
                        {message: text},
                        function()
                        {
                            setTimeout(postUpdate, 30*1000);
                        }
                )
            }
            ,
            {scope: 'publish_actions'});
        };

        // Function to mirror the follow profile
        function mirrorPost()
        {
            //FB.login(function() {
                FB.api( following,
                        { },
                        function(response)
                        {
                            if(response.data[0]['created_time']
                                != lastPost )
                            {
                                lastPost =
                                    response.data[0]['created_time'];
                                console.log('new post');
                                postClone(response);
                            }
                            else
                            {
                                console.log('no');
                            }
                            setTimeout(mirrorPost , 30*1000);
                        }
                )
            //});
        };

        // Login, get permissions and clone a post
        function postClone(getPosts)
        {
            var obj = {};
            var template = ["message", "link"];
            for(var t in template)
            {
                if(getPosts.data[0][template[t]])
                    obj[template[t]] = getPosts.data[0][template[t]];
            }

            FB.login(function() {
                FB.api('/me/feed', 'post', obj);
                }
                ,
                {scope: 'publish_actions'}
            );
        }

        // Login, get permissions and post
        function postThis(text)
        {
            FB.login(function() {
                FB.api('/me/feed', 'post', {message: text});
                }
                ,
                {scope: 'publish_actions'}
            );
        }

        //postUpdate();
        mirrorPost();

    }; // End of Facebook Code

    // Load the SDK asynchronously
    (function(d, s, id){
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>

<div class="message">
<p>Você está seguindo o conteúdo de --------</p>
</div>

</body>
</html>
